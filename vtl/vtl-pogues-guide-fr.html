<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Guide VTL Pogues</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="css/spectre.min.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Guide VTL Pogues</h1>
</header>
<div class="container">
<p>Ce document guide l’utilisateur de Pogues dans son usage du langage VTL.</p>
<h1 id="vtl">VTL</h1>
<p><a href="https://sdmx.org/?page_id=5096">VTL</a> (Validation and Transformation Language) est un langage de programmation né dans le giron du standard de description de données aggrégées SDMX. Ce langage est adopté ou en cours d’adoption par les mêmes utilisateurs que SDMX, essentiellement des banques centrales et des instituts nationaux de statistiques.</p>
<p>Bien que conçu initialement pour le traitement de données aggrégées (eg des tableaux ou cubes de données), le langage est suffisamment souple pour qu’on puisse l’utiliser pour exprimer des contrôles, comme dans le cas des contrôles mis en oeuvre dans le cadre d’un questionnement.</p>
<p>On a donc choisi ce langage comme expression des contrôles et du dynamisme dans les questionnaires conçus dans Pogues dont la cible est les nouveaux outils de collecte développés dans le cadre du programme Metallica.</p>
<p>Les éléments les plus importants à retenir de l’usage de VTL dans Pogues :</p>
<ul>
<li>l’écriture se fait via un éditeur de code VTL,</li>
<li>le type des variables que l’on collecte est toujours “texte”, ce qui oblige à changer ce type pour des opérations numériques,</li>
<li>…</li>
</ul>
<h1 id="utiliser-vtl">Utiliser VTL</h1>
<p>VTL est utilisé dès que l’on souhaite :</p>
<ul>
<li>créer un libellé personnalisé</li>
<li>définir un contrôle</li>
<li>créer une variable calculée</li>
<li>définir la condition d’un filtre</li>
</ul>
<p>Les champs correspondants dans Pogues proposent dans la plupart des cas un <strong>éditeur VTL</strong> :</p>
<figure>
<img src="img/vtl-in-pogues-editeur-variable.png" alt="L’éditeur VTL" /><figcaption aria-hidden="true">L’éditeur VTL</figcaption>
</figure>
<h2 id="fonctionnalités-de-léditeur">Fonctionnalités de l’éditeur</h2>
<p><span class="label label-rounded label-primary">À noter</span> L’éditeur disponible actuellement reste un work-in-progress</p>
<p>L’éditeur fournit :</p>
<ul>
<li>un soulignement syntaxique</li>
<li>une autocomplétion des fonctions et variables</li>
<li>une gestion des erreurs de syntaxe</li>
</ul>
<h1 id="libellés">Libellés</h1>
<p>Voici un exemple de syntaxe pour un libellé personnalisé :</p>
<figure>
<img src="img/vtl-in-pogues-custom-label.png" alt="Libellé personnalisé" /><figcaption aria-hidden="true">Libellé personnalisé</figcaption>
</figure>
<p>On utilise ici l’opérateur VTL <code>||</code> qui permet de concaténer des chaînes de caractères, ou une chaîne de caractères et une variable (ici <code>NOM</code>).</p>
<p><span class="label label-rounded label-warning">Attention !</span> Pour des raisons d’implémentation historique, il est encore nécessaire d’encadrer les noms de variables par <code>$</code>. Ainsi, <strong>on pourra rechercher la variable <code>NOM</code> en la tapant telle quelle dans l’éditeur</strong>, puis on ajoutera <code>$</code> en préfixe et suffixe, pour obtenir <code>$NOM$</code></p>
<p><span class="label label-rounded label-success">Astuce :)</span> Dans l’exemple précédent, on ne gère pas le cas où la variable n’a pas été remplie. Pour anticiper ce cas, on peut utiliser la fonction VTL <code>nvl</code>, le libellé personnalisé devient ainsi :</p>
<figure>
<img src="img/vtl-in-pogues-custom-label-nvl.png" alt="Libellé personnalisé avec gestion de la nullité" /><figcaption aria-hidden="true">Libellé personnalisé avec gestion de la nullité</figcaption>
</figure>
<p>Plus d’infos sur l’usage de <code>nvl</code> plus bas.</p>
<p>On pourra mobiliser dans un libellé personnalisé des variables collectées, calculées ou externes.</p>
<h2 id="infobulles">Infobulles</h2>
<p>La syntaxe pour la création d’un infobulle est la suivante :</p>
<pre class="code"><code>Mon libellé de question avec [une infobulle](. &quot;dont voici le contenu&quot;).</code></pre>
<p><span class="label label-rounded label-warning">Attention !</span> Il faut bien respecter la syntaxe pour le contenu de l’infobulle : un <code>.</code> avant le texte entouré de guillemets <code>"</code>.</p>
<h1 id="contrôles">Contrôles</h1>
<p>Un exemple de contrôle sur une valeur numérique :</p>
<figure>
<img src="img/vtl-in-pogues-simple-control.png" alt="Vérification de l’âge du répondant" /><figcaption aria-hidden="true">Vérification de l’âge du répondant</figcaption>
</figure>
<h1 id="variables-calculées">Variables calculées</h1>
<p>Pogues permet de créer des variables calculées à partir de variables collectées. Dans l’exemple ci-dessous, on somme les variables de revenus de l’enquêté et de son conjoint :</p>
<figure>
<img src="img/vtl-in-pogues-computed-variable-earnings.png" alt="Une variable calculée" /><figcaption aria-hidden="true">Une variable calculée</figcaption>
</figure>
<p>L’expression VTL est :</p>
<pre class="code"><code>cast(nvl($REVENUS$, &quot;0&quot;), integer) + 
cast(nvl($REVENUS_CONJOINT$, &quot;0&quot;), integer)</code></pre>
<p><span class="label label-rounded label-warning">Attention !</span> Les variables collectées sont de type “chaîne de caractères” (<code>string</code> en VTL), pour les utiliser dans un calcul il faut les transformer, en entier par exemple. Pour cela, c’est la fonction <code>cast</code> qui est utilisé. Pour transformer la variable <code>REVENUS</code> en entier, j’écris donc <code>cast(nvl($REVENUS$, "0"), integer)</code>.</p>
<h1 id="filtres">Filtres</h1>
<p>Voici un exemple de filtre simple exprimé en VTL :</p>
<figure>
<img src="img/vtl-in-pogues-simple-filter.png" alt="Un filtre simple" /><figcaption aria-hidden="true">Un filtre simple</figcaption>
</figure>
<p><span class="label label-rounded label-primary">À noter</span> À ce jour, le champ “Condition d’affichage” du filtre n’utilise pas l’éditeur VTL.</p>
<p>Toutes formes d’expression booléenne est valide :</p>
<pre class="code"><code># Possible
$MA_VARIABLE_CHAINE$ = &quot;a value&quot;

# Ou
$MA_VARIABLE_NUMERIQUE$ = 42

# Plus direct
$MA_VARIABLE_BOOLEENNE$</code></pre>
<p>Un exemple plus complexe combinant plusieurs variables avec des “et” (<code>and</code>) et des “ou” (<code>or</code>) :</p>
<pre class="code"><code>nvl($EXCLUSIVE_VAR$, false) and 
(nvl($OTHER_VAR1$, false) or nvl($OTHER_VAR2$, false) or nvl($OTHER_VAR3$, false))</code></pre>
<h1 id="gestion-de-la-nullité">Gestion de la nullité</h1>
<blockquote>
<p>TODO usage de <code>nvl()</code></p>
</blockquote>
<h1 id="types-des-variables">Types des variables</h1>
<blockquote>
<p>TODO</p>
</blockquote>
<h1 id="fonctions-et-opérateurs">Fonctions et opérateurs</h1>
<h2 id="logique">Logique</h2>
<table>
<thead>
<tr class="header">
<th>Nom</th>
<th>Symbole</th>
<th>Exemple</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Ou</td>
<td>or</td>
<td>true or false</td>
</tr>
<tr class="even">
<td>Et</td>
<td>and</td>
<td>true and false</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="chaînes-de-caractères">Chaînes de caractères</h2>
<h3 id="remplacer">Remplacer</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Symbole</th>
<th style="text-align: left;">Exemple</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Remplacement</td>
<td style="text-align: left;">replace</td>
<td style="text-align: left;"><code>replace("bag", "g", "c") # → bac</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</body>
</html>
